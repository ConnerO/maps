<!DOCTYPE html>
<html>
<head>
 <title>AustinMaps</title>

 <style>
  #map {
   width: 500px;
   height: 400px;
   background-color: #CCC;
  }
    </style>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>

  <script
  src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDTx6HnaOWxCy2LitrHA0qX1oSkwwUFcpg&libraries=geometry,visualization">
  </script>
  <script>

    function initialize() {
      var mapCanvas = document.getElementById('map');
      var myLatLng = {lat: 30.2500, lng: -97.7500};
      var mapOptions = {
        center: new google.maps.LatLng(30.2500, -97.7500),
        zoom: 9,
        mapTypeId: google.maps.MapTypeId.ROADMAP
      }

      var map = new google.maps.Map(mapCanvas, mapOptions);

      addresses = [];

      $.getJSON('https://data.austintexas.gov/resource/b4y9-5x39.json', function(data){
        for (var i=0; i < data.length; i++) {
          // var coords = results.features[i].geometry.coordinates;
          var crime = data[i].crime_type;
          var address = data[i].address;
          // console.log(crime, address);
          addresses.push([address+", Austin",crime]);
          // console.log(addresses[i]);
        }

        // console.log(addresses);
        for (var x = 0; x < 10; x++) {
          // var y = this.addresses[x][1];
          (function(x) {
            $.ajax({
              dataType: "json",
              url: "http://maps.googleapis.com/maps/api/geocode/json?address="+addresses[x][0]+"&sensor=false",
              // data: null,
              success: function (data){
                var p = data.results[0].geometry.location
                var latlng = new google.maps.LatLng(p.lat, p.lng);
                console.log(x);
                var marker = new google.maps.Marker({
                  position: latlng,
                  map: map,
                  title: addresses[x][1]
                                  // console.log(title);
          
                // console.log(latlng);
                });
                marker.addListener('click', function() {
                  // map.setZoom(15);
                  map.setCenter(marker.getPosition());
                  console.log(marker.title);
                });



                // data.marker.event(marker, 'click', (function(marker, x) {
                //   return function() {
                //   infowindow.setContent(addresses[x][0]);
                //   infowindow.open(map, marker);
                //   }
                // })(marker, x));

              }
            })
          })(x);
        }
      });
    }
        //   // Create a <script> tag and set the USGS URL as the source.
        //   var script = document.createElement('script');

        //   script.src = 'http://earthquake.usgs.gov/earthquakes/feed/v1.0/summary/2.5_week.geojsonp';
        //   document.getElementsByTagName('head')[0].appendChild(script);
        // }

// EARTHQUAKE RESULTS

        //   function eqfeed_callback(results) {
        //   var heatmapData = [];
        //   for (var i = 0; i < results.features.length; i++) {
        //     var coords = results.features[i].geometry.coordinates;
        //     var latLng = new google.maps.LatLng(coords[1], coords[0]);
        //     var magnitude = results.features[i].properties.mag;
        //     var weightedLoc = {
        //       location: latLng,
        //       weight: Math.pow(2, magnitude)
        //     };
        //     heatmapData.push(weightedLoc);
        //   }
        //   var heatmap = new google.maps.visualization.HeatmapLayer({
        //     data: heatmapData,
        //     dissipating: true,
        //     map: map
        //   });
        // }




// THIS IS A DIFFERENT VERSION OF THE AJAX CALL ABOVE. IT WORKS   

          // $.getJSON("http://maps.googleapis.com/maps/api/geocode/json?address="+addresses[x]+"&sensor=false", null, function (data) {
          //     var p = data.results[0].geometry.location
          //     var latlng = new google.maps.LatLng(p.lat, p.lng);
          //     new google.maps.Marker({
          //         position: latlng,
          //         map: map
          //     });

          // });



        //   function codeAddress() {
        //     var address = "Austin, TX";
        //     geocoder.geocode( { 'address': address}, function(results, status) {
        //       if (status == google.maps.GeocoderStatus.OK) {
        //         map.setCenter(results[0].geometry.location);
        //         var marker = new google.maps.Marker({
        //           map: map,
        //           position: results[0].geometry.location,
        //           title: crime
        //         });
        //       } else {
        //         alert("Geocode was not successful for the following reason: " + status);
        //       }
        //       console.log(results,status);
        //     });
        //   }

        // codeAddress();


        google.maps.event.addDomListener(window, 'load', initialize);



  </script>



</head>
<body>
  <div id="map"></div>
</body>
</html>